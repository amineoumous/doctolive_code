{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useMemo, useEffect, useCallback } from 'react';\nimport { Row, Col, Collapse, Alert } from 'react-bootstrap';\nimport SubmitButton from './../../components/CustomButtons/SubmitButton.js'; // import AddIcon from '@material-ui/icons/Add';\n\nimport { useDropzone } from 'react-dropzone';\nimport { useAuth } from \"../../context/AuthContext\";\nimport Config from './../../EndPoint';\nimport { Typography } from '@material-ui/core';\nimport ReactFancyBox from './../fancyBox/fancybox/ReactFancyBox';\nimport { TiDeleteOutline } from 'react-icons/ti';\nconst baseStyle = {\n  flex: 1,\n  display: 'flex',\n  flexDirection: 'column',\n  alignItems: 'center',\n  padding: '40px 20px',\n  cursor: 'pointer',\n  borderWidth: 2,\n  borderRadius: 2,\n  borderColor: '#eeeeee',\n  borderStyle: 'dashed',\n  backgroundColor: '#fafafa',\n  color: '#bdbdbd',\n  outline: 'none',\n  transition: 'border .24s ease-in-out'\n};\nconst activeStyle = {\n  borderColor: '#2196f3'\n};\nconst acceptStyle = {\n  borderColor: '#00e676'\n};\nconst rejectStyle = {\n  borderColor: '#ff1744'\n};\nexport default function Images(props) {\n  const {\n    userData\n  } = useAuth();\n  const {\n    0: etatRequest,\n    1: setEtatRequest\n  } = useState({\n    success: false,\n    sending: false,\n    donneIncorrect: false\n  });\n  const {\n    0: files,\n    1: setFiles\n  } = useState([]);\n  const {\n    0: rejectedFiles,\n    1: setRejectedFiles\n  } = useState([]);\n  const {\n    0: savedPictures,\n    1: setSavedPictures\n  } = useState([]);\n  const {\n    0: canceledPictures,\n    1: setCanceledPictures\n  } = useState([]);\n  useEffect(() => {\n    if (props.documents) {\n      setSavedPictures(props.documents);\n    }\n\n    return () => {};\n  }, [props.documents]);\n  useEffect(() => {\n    if (props.socket) {\n      props.socket.on('newDocuments', response => {\n        if (response.consultationId === props.consultation.id) {\n          setSavedPictures(oldPic => [...oldPic, ...response.uploadedFiles]);\n        }\n      });\n    }\n\n    return () => {\n      if (props.socket) {\n        props.socket.removeAllListeners('newDocuments');\n      }\n    };\n  }, [props.socket]);\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setEtatRequest(oldData => {\n      return _objectSpread(_objectSpread({}, oldData), {}, {\n        sending: true\n      });\n    });\n\n    try {\n      let response = await fetch(`${Config.BACKEND_URL}/upload/document`, {\n        method: 'POST',\n        body: JSON.stringify({\n          data: files,\n          consultation: props.consultation,\n          sentTo: \"medecin\"\n        }),\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n          'Authorization': `token ${userData.token}`\n        }\n      });\n      response.json().then(uploadingFile => {\n        if (!uploadingFile.error) {\n          setEtatRequest(oldData => {\n            return _objectSpread(_objectSpread({}, oldData), {}, {\n              sending: false,\n              success: true\n            });\n          });\n\n          if (uploadingFile.savedPictures.length > 0) {\n            setSavedPictures(oldPic => [...oldPic, ...uploadingFile.savedPictures]);\n          }\n\n          if (uploadingFile.canceledData.length > 0) {\n            uploadingFile.canceledData.map(dd => {\n              setCanceledPictures(oldData => [...oldData, files[dd.index]]);\n            });\n            setFiles([]);\n            setRejectedFiles([]);\n          } else {\n            setFiles([]);\n            setRejectedFiles([]);\n          }\n\n          props.socket.emit('newDocuments', {\n            uploadedFiles: uploadingFile.savedPictures,\n            consultationId: props.consultation.id,\n            selectedUser: \"m\" + props.consultation.medecin.id\n          }, response => {});\n        } else {\n          setEtatRequest(oldData => {\n            return _objectSpread(_objectSpread({}, oldData), {}, {\n              sending: false,\n              success: false,\n              donneIncorrect: true\n            });\n          });\n        }\n      }).catch(err => {\n        setEtatRequest(oldData => {\n          return _objectSpread(_objectSpread({}, oldData), {}, {\n            sending: false,\n            success: false,\n            donneIncorrect: true\n          });\n        });\n      });\n    } catch (err) {\n      console.log(err);\n      setEtatRequest(oldData => {\n        return _objectSpread(_objectSpread({}, oldData), {}, {\n          sending: false,\n          success: false,\n          donneIncorrect: true\n        });\n      });\n    }\n  };\n\n  const deleteImageHandle = async file => {\n    let response = await fetch(`${Config.BACKEND_URL}/upload/document`, {\n      method: 'DELETE',\n      body: JSON.stringify({\n        path: file.path,\n        id: file.id\n      }),\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'Authorization': `token ${userData.token}`\n      }\n    });\n    response.json().then(response => {\n      let index = savedPictures.findIndex(fl => fl.id === file.id);\n      setSavedPictures(oldFiles => {\n        let clone = [...oldFiles];\n        clone.splice(index, 1);\n        return clone;\n      });\n    }).catch(error => {});\n  };\n\n  const removeImageHandle = file => {\n    let index = files.findIndex(fl => fl.id === file.id);\n    setFiles(oldFiles => {\n      let clone = [...oldFiles];\n      clone.splice(index, 1);\n      return clone;\n    });\n  };\n\n  const onDrop = useCallback((acceptedFiles, rejectedFiles) => {\n    rejectedFiles.map(rejectedFile => {\n      if (rejectedFile.file.type.split('/')[0] === \"image\") {\n        const reader = new FileReader();\n        reader.readAsDataURL(rejectedFile.file);\n\n        reader.onloadend = () => {\n          let newFile = {\n            filePath: reader.result,\n            realName: rejectedFile.file.name,\n            type: 'file',\n            fileType: rejectedFile.file.type.split('/')[0]\n          };\n          setRejectedFiles(existing => [...existing, {\n            file: newFile,\n            errors: rejectedFile.errors\n          }]);\n        };\n      } else {\n        let newFile = {\n          realName: rejectedFile.file.name,\n          type: 'file',\n          fileType: rejectedFile.file.type.split('/')[0]\n        };\n        setRejectedFiles(existing => [...existing, {\n          file: newFile,\n          errors: rejectedFile.errors\n        }]);\n      }\n    });\n    acceptedFiles.forEach(file => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onloadend = () => {\n        let newFile = {\n          filePath: reader.result,\n          realName: file.name,\n          type: 'file',\n          fileType: \"image\",\n          kind: file.type\n        };\n        setFiles(existing => [...existing, newFile]);\n      };\n    });\n  }, []);\n  const {\n    getRootProps,\n    getInputProps,\n    isDragActive,\n    isDragAccept,\n    isDragReject\n  } = useDropzone({\n    onDrop,\n    accept: 'image/jpeg, image/png, image/jpg, application/pdf'\n  });\n  const style = useMemo(() => _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, baseStyle), isDragActive ? activeStyle : {}), isDragAccept ? acceptStyle : {}), isDragReject ? rejectStyle : {}), [isDragActive, isDragReject, isDragAccept]);\n  return /*#__PURE__*/_jsx(\"form\", {\n    onSubmit: handleSubmit,\n    autoComplete: \"off\",\n    children: /*#__PURE__*/_jsxs(Col, {\n      children: [savedPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"mb-3\",\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h5\",\n          component: \"h5\",\n          children: \" Documents d\\xE9j\\xE0 partager dans cette consultation \"\n        })\n      }) : null, savedPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"images-saved\",\n        children: savedPictures.map((file, index) => {\n          return /*#__PURE__*/_jsx(Col, {\n            className: \"mt-5\",\n            lg: \"2\",\n            md: \"4\",\n            xs: \"6\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"image-saved\",\n              children: [file.type === \"application/pdf\" ? /*#__PURE__*/_jsxs(\"a\", {\n                href: Config.BACKEND_URL + file.path,\n                download: file.name,\n                target: \"_blank\",\n                rel: \"noopener noreferrer\",\n                children: [\"  \", /*#__PURE__*/_jsx(\"img\", {\n                  src: \"/image/pdf.png\",\n                  alt: \"...\",\n                  className: \"img-fluid\"\n                }), \" \"]\n              }) : /*#__PURE__*/_jsx(ReactFancyBox, {\n                thumbnail: `${Config.BACKEND_URL}${file.path}`,\n                showCloseBtn: false,\n                image: `${Config.BACKEND_URL}${file.path}`\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                onClick: () => deleteImageHandle(file),\n                className: \"delete-button\",\n                children: [\" \", /*#__PURE__*/_jsx(TiDeleteOutline, {}), \" \"]\n              })]\n            })\n          }, index);\n        })\n      }) : null, /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center justify-content-around mt-4 \",\n        children: /*#__PURE__*/_jsxs(\"div\", _objectSpread(_objectSpread({}, getRootProps({\n          style,\n          className: \"dropzone\"\n        })), {}, {\n          children: [/*#__PURE__*/_jsx(\"input\", _objectSpread({}, getInputProps())), /*#__PURE__*/_jsx(\"p\", {\n            children: \"Glisser d\\xE9poser des fichiers ici ou\"\n          }), \" \", /*#__PURE__*/_jsx(\"h4\", {\n            children: \" PARCOURIR SUR MON ORDINATEUR \"\n          })]\n        }))\n      }), canceledPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"mt-5\",\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h5\",\n          component: \"h5\",\n          color: \"error\",\n          children: \" Ces documents n'on pas pus s'enregistrer au sein de nos serveur. essayer ult\\xE9ri\\xE9rement o\\xF9 bien essayer d'autre images \"\n        })\n      }) : null, canceledPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"images-canceled\",\n        children: canceledPictures.map((file, index) => {\n          return /*#__PURE__*/_jsxs(Col, {\n            className: \"mt-5\",\n            lg: \"2\",\n            md: \"4\",\n            xs: \"6\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"image-canceled\",\n              children: /*#__PURE__*/_jsx(ReactFancyBox, {\n                thumbnail: file.filePath,\n                showCloseBtn: false,\n                image: file.filePath\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsx(Typography, {\n                color: \"error\",\n                children: \" Le serveur n'a pas pus suporter ces fichier \"\n              })\n            })]\n          }, index);\n        })\n      }) : null, /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center justify-content-around mt-4 \",\n        children: files.map((file, index) => {\n          return /*#__PURE__*/_jsxs(Col, {\n            className: \"mt-5\",\n            lg: \"6\",\n            md: \"6\",\n            xs: \"6\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"selecting-img-container\",\n              children: [/*#__PURE__*/_jsx(ReactFancyBox, {\n                thumbnail: file.kind === \"application/pdf\" ? '/image/fileaccepted.png' : file.filePath,\n                showCloseBtn: false,\n                image: file.kind === \"application/pdf\" ? '/image/fileaccepted.png' : file.filePath\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                onClick: () => removeImageHandle(file),\n                className: \"delete-button\",\n                children: [\" \", /*#__PURE__*/_jsx(TiDeleteOutline, {}), \" \"]\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsxs(\"p\", {\n                className: \"mt-3\",\n                children: [\" \", file.realName, \" \"]\n              })\n            })]\n          }, index);\n        })\n      }), rejectedFiles.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"mt-5\",\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h5\",\n          component: \"h5\",\n          color: \"error\",\n          children: \" Fichier non acc\\xE9pter ils ne seront pas enregistrer sur le serveur \"\n        })\n      }) : null, /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center mt-4 \",\n        children: rejectedFiles.map((rejectedFile, index) => {\n          return /*#__PURE__*/_jsxs(Col, {\n            className: \"\",\n            lg: \"6\",\n            md: \"12\",\n            xs: \"12\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"rejected-img-container\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/img/file-rejected.png\",\n                alt: \"fichier rejeter\",\n                className: \"img-fluid\"\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"mt-3\",\n                children: rejectedFile.errors.map((err, ind) => {\n                  return /*#__PURE__*/_jsx(\"div\", {\n                    children: err.code === \"file-invalid-type\" ? /*#__PURE__*/_jsxs(Typography, {\n                      color: \"error\",\n                      children: [\" Ce fichier \", /*#__PURE__*/_jsxs(\"span\", {\n                        className: \"type-file-span\",\n                        children: [\" \", rejectedFile.file.realName, \" \"]\n                      }), \" est de type \", /*#__PURE__*/_jsxs(\"span\", {\n                        className: \"type-file-span\",\n                        children: [\" \", rejectedFile.file.fileType, \" \"]\n                      }), \" . Seulement les images \", /*#__PURE__*/_jsx(\"span\", {\n                        className: \"type-file-span\",\n                        children: \"png, jpg et jpeg et document pdf  \"\n                      }), \"  sont acc\\xE9pter \"]\n                    }) : \"\"\n                  }, ind);\n                })\n              })\n            })]\n          }, index);\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        children: /*#__PURE__*/_jsx(Collapse, {\n          in: etatRequest.donneIncorecte,\n          children: /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(Alert, {\n              variant: \"danger\",\n              children: \"Un ou plusieur document n'a pas pus enregistrer\"\n            })\n          })\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        children: /*#__PURE__*/_jsx(Collapse, {\n          in: etatRequest.success,\n          children: /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(Alert, {\n              variant: \"success\",\n              children: \"Les document sont enregistrer avec succ\\xE9s\"\n            })\n          })\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center justify-content-around mt-4 \",\n        children: /*#__PURE__*/_jsx(SubmitButton, {\n          disabled: files.length <= 0,\n          sending: etatRequest.sending,\n          successRequest: etatRequest.success,\n          type: \"submit\",\n          color: \"primary\",\n          children: \" Enregistrer \"\n        })\n      })]\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}