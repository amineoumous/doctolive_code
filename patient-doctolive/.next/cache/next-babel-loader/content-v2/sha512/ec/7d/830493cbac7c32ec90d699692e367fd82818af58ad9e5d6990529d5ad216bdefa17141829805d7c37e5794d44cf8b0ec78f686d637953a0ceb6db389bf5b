{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\CARRE\\\\Documents\\\\GitHub\\\\doctolive_code\\\\patient-doctolive\\\\context\\\\AuthContext.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// src/context/state.js\nimport { createContext, useContext } from 'react';\nimport { useState, useEffect } from 'react';\nimport Cookies from 'js-cookie';\nimport { useRouter } from 'next/router';\nimport Button from './../components/CustomButtons/Button';\nimport contentFR from './../contentFR';\nimport contentEN from './../contentEN';\nimport contentAR from './../contentAR'; // @material-ui/icons\n\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport IconButton from '@material-ui/core/IconButton';\nimport { MdVisibility, MdVisibilityOff } from 'react-icons/md';\nimport Config from './../EndPoint';\nimport { Dialog, DialogTitle, DialogContent, DialogContentText, DialogActions } from '@material-ui/core';\nconst AppContext = /*#__PURE__*/createContext();\nexport function AuthWrapper({\n  children\n}) {\n  let existinguserData = Cookies.get(\"patientData\");\n  existinguserData = existinguserData != undefined ? JSON.parse(existinguserData) : {};\n  const router = useRouter();\n  const {\n    locale\n  } = router;\n  const content = locale === \"ar\" ? contentAR : locale === \"en\" ? contentEN : contentFR;\n  const {\n    0: userData,\n    1: setUserData\n  } = useState(existinguserData);\n  const {\n    0: addedByAdmin,\n    1: setAddedByAdmin\n  } = useState(false);\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    password_confirmation: \"\",\n    password: \"\",\n    old_password: \"\"\n  });\n\n  const setUser = data => {\n    if (!data.token) {\n      Cookies.set('patientData', {}, {\n        expires: -1000\n      });\n      setUserData({\n        isAuth: false\n      });\n      return router.push({\n        pathname: `/account/new`\n      });\n    } else {\n      setAddedByAdmin(data.user.addedByAdmin && !data.user.passwordChanged);\n      Cookies.set('patientData', JSON.stringify(data));\n      Cookies.set('token', data.token);\n      setUserData(data);\n    }\n  };\n\n  useEffect(() => {\n    if (userData.token) {\n      setAddedByAdmin(userData.user.addedByAdmin && !userData.user.passwordChanged);\n      fetch(`${Config.BACKEND_URL}/patient/verify`, {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `token ${userData.token}`\n        }\n      }).then(r => r.json().then(res => {\n        if (!res.error) {// setUserData(existinguserData);\n        } else {\n          setUserData({\n            isAuth: false\n          });\n        }\n      })).catch(error => {\n        setUserData({\n          isAuth: false\n        });\n      });\n    }\n\n    return () => {};\n  }, []);\n\n  const handleConfirmation = () => {\n    let testPass = state.password.trimStart();\n\n    if (testPass.length > 6) {\n      let data = {\n        password: state.password,\n        password_confirmation: state.password_confirmation,\n        old_password: state.old_password,\n        email: userData.user.email\n      };\n      fetch(`${Config.BACKEND_URL}/patient/new-password`, {\n        method: 'PUT',\n        body: JSON.stringify(data),\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n          'Authorization': `token ${userData.token}`\n        }\n      }).then(res => {\n        console.log(res);\n        setAddedByAdmin(false);\n        setUserData(res.data.updatePatient);\n      }).catch(err => {\n        console.log(err.response);\n      });\n    }\n  };\n\n  const handleChange = ({\n    target: {\n      value,\n      name\n    }\n  }) => {\n    setState(old => {\n      return _objectSpread(_objectSpread({}, old), {}, {\n        [name]: value\n      });\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(AppContext.Provider, {\n    value: {\n      userData,\n      setUser\n    },\n    children: [children, /*#__PURE__*/_jsxDEV(Dialog // open={false}\n    , {\n      open: addedByAdmin,\n      onClose: () => {},\n      \"aria-labelledby\": \"alert-dialog-title\",\n      \"aria-describedby\": \"alert-dialog-description\",\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        id: \"alert-dialog-title\",\n        children: \" Renouveler le mot de passe \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [/*#__PURE__*/_jsxDEV(DialogContentText, {\n          id: \"alert-dialog-description\",\n          children: \"Ce compte \\xE0 tait cr\\xE9er avec un administrateur, alors ce mot de passe \\xE0 \\xE9tait g\\xE9n\\xE9rer d'une mani\\xE9re al\\xE9atoir. On vous recomande de saisir un nouveau mot de passe pour la scuit\\xE9 de vos information.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n          className: \"mt-3\",\n          fullWidth: true,\n          variant: \"outlined\",\n          children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n            htmlFor: \"standard-adornment-password\",\n            children: [\" \", content.new.oldpassLabel, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(OutlinedInput, {\n            id: \"standard-adornment-password\",\n            type: state.showPassword ? 'text' : 'password',\n            value: state.old_password,\n            onChange: handleChange,\n            required: true,\n            label: content.new.oldpassLabel,\n            name: \"old_password\",\n            endAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n              position: \"end\",\n              children: /*#__PURE__*/_jsxDEV(IconButton, {\n                \"aria-label\": \"toggle password visibility\",\n                onClick: () => setState(old => {\n                  return _objectSpread(_objectSpread({}, old), {}, {\n                    showPassword: !state.showPassword\n                  });\n                }),\n                children: state.showPassword ? /*#__PURE__*/_jsxDEV(MdVisibility, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 160,\n                  columnNumber: 41\n                }, this) : /*#__PURE__*/_jsxDEV(MdVisibilityOff, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 160,\n                  columnNumber: 60\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 156,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n          className: \"mt-3\",\n          fullWidth: true,\n          variant: \"outlined\",\n          children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n            htmlFor: \"standard-adornment-password\",\n            children: [\" \", content.new.passLabel, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(OutlinedInput, {\n            id: \"standard-adornment-password\",\n            type: state.showPassword ? 'text' : 'password',\n            value: state.password,\n            onChange: handleChange,\n            required: true,\n            label: content.new.passLabel,\n            name: \"password\",\n            endAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n              position: \"end\",\n              children: /*#__PURE__*/_jsxDEV(IconButton, {\n                \"aria-label\": \"toggle password visibility\",\n                onClick: () => setState(old => {\n                  return _objectSpread(_objectSpread({}, old), {}, {\n                    showPassword: !state.showPassword\n                  });\n                }),\n                children: state.showPassword ? /*#__PURE__*/_jsxDEV(MdVisibility, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 182,\n                  columnNumber: 41\n                }, this) : /*#__PURE__*/_jsxDEV(MdVisibilityOff, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 182,\n                  columnNumber: 60\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 178,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n          className: \"mt-3\",\n          fullWidth: true,\n          variant: \"outlined\",\n          children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n            htmlFor: \"standard-adornment-password\",\n            children: [\" \", content.new.confirmpassLabel, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(OutlinedInput, {\n            id: \"standard-adornment-password\",\n            type: state.showPassword ? 'text' : 'password',\n            value: state.password_confirmation,\n            onChange: handleChange,\n            required: true,\n            label: content.new.confirmpassLabel,\n            name: \"password_confirmation\",\n            endAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n              position: \"end\",\n              children: /*#__PURE__*/_jsxDEV(IconButton, {\n                \"aria-label\": \"toggle password visibility\",\n                onClick: () => setState(old => {\n                  return _objectSpread(_objectSpread({}, old), {}, {\n                    showPassword: !state.showPassword\n                  });\n                }),\n                children: state.showPassword ? /*#__PURE__*/_jsxDEV(MdVisibility, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 204,\n                  columnNumber: 41\n                }, this) : /*#__PURE__*/_jsxDEV(MdVisibilityOff, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 204,\n                  columnNumber: 60\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleConfirmation,\n          color: \"danger\",\n          children: \"Confirmer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 5\n  }, this);\n}\nexport function useAuth() {\n  return useContext(AppContext);\n}","map":{"version":3,"sources":["C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/context/AuthContext.js"],"names":["createContext","useContext","useState","useEffect","Cookies","useRouter","Button","contentFR","contentEN","contentAR","InputLabel","FormControl","OutlinedInput","InputAdornment","IconButton","MdVisibility","MdVisibilityOff","Config","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","AppContext","AuthWrapper","children","existinguserData","get","undefined","JSON","parse","router","locale","content","userData","setUserData","addedByAdmin","setAddedByAdmin","state","setState","password_confirmation","password","old_password","setUser","data","token","set","expires","isAuth","push","pathname","user","passwordChanged","stringify","fetch","BACKEND_URL","headers","then","r","json","res","error","catch","handleConfirmation","testPass","trimStart","length","email","method","body","console","log","updatePatient","err","response","handleChange","target","value","name","old","new","oldpassLabel","showPassword","passLabel","confirmpassLabel","useAuth"],"mappings":"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","sourcesContent":["// src/context/state.js\r\nimport { createContext, useContext } from 'react';\r\nimport { useState, useEffect } from 'react';\r\n\r\nimport Cookies from 'js-cookie';\r\nimport { useRouter } from 'next/router';\r\n\r\nimport Button from './../components/CustomButtons/Button'\r\n\r\n\r\nimport contentFR from './../contentFR'\r\nimport contentEN from './../contentEN'\r\nimport contentAR from './../contentAR'\r\n\r\n// @material-ui/icons\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\n\r\n\r\n\r\nimport FormControl from '@material-ui/core/FormControl';\r\n\r\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\r\nimport InputAdornment from '@material-ui/core/InputAdornment';\r\nimport IconButton from '@material-ui/core/IconButton';\r\n\r\nimport {MdVisibility, MdVisibilityOff} from 'react-icons/md'\r\n\r\n\r\nimport Config from './../EndPoint';\r\nimport { Dialog, DialogTitle, DialogContent, DialogContentText, DialogActions } from '@material-ui/core';\r\nconst AppContext = createContext();\r\n\r\n\r\nexport function AuthWrapper({ children }) {\r\n  let existinguserData = Cookies.get(\"patientData\");\r\n\r\n  existinguserData = (existinguserData != undefined) ? JSON.parse(existinguserData) : {};\r\n  const router = useRouter();\r\n  const {locale} = router;\r\n\r\n  const content = locale === \"ar\" ? contentAR : locale === \"en\" ? contentEN : contentFR;\r\n\r\n    const [userData, setUserData] = useState(existinguserData);\r\n    const [addedByAdmin, setAddedByAdmin] = useState(false);\r\n    const [state, setState] = useState({\r\n      password_confirmation: \"\",\r\n      password:\"\",\r\n      old_password:\"\",\r\n});\r\n    const setUser = (data) => {\r\n      if(!data.token){\r\n        Cookies.set('patientData', {}, { expires: -1000 });\r\n\r\n\r\n        setUserData({isAuth: false});\r\n        return router.push({\r\n          pathname: `/account/new`,\r\n        })\r\n      }else {\r\n        setAddedByAdmin(data.user.addedByAdmin && !data.user.passwordChanged);\r\n        Cookies.set('patientData', JSON.stringify(data));\r\n        Cookies.set('token', data.token);\r\n        setUserData(data);\r\n      }\r\n       \r\n    }\r\n\r\n    useEffect(() => {\r\n      if(userData.token){\r\n        setAddedByAdmin(userData.user.addedByAdmin && !userData.user.passwordChanged);\r\n        fetch(`${Config.BACKEND_URL}/patient/verify`,{\r\n          headers: {\r\n              'Content-Type': 'application/json',\r\n              'Authorization': `token ${userData.token}`,\r\n          },\r\n        })\r\n        .then(\r\n            (r) => r.json()\r\n            .then(res => {\r\n\r\n                if(!res.error){\r\n                  // setUserData(existinguserData);\r\n                }else {\r\n                  setUserData({isAuth: false});\r\n                }\r\n          \r\n            })\r\n        ).catch(error =>{ \r\n            setUserData({isAuth: false});\r\n        })\r\n      }\r\n\r\n        return () => {\r\n            \r\n        }\r\n    }, [])\r\n      \r\n    const handleConfirmation = () => {\r\n      let testPass = state.password.trimStart();\r\n\r\n      if(testPass.length > 6) {\r\n        let data = {password: state.password, password_confirmation: state.password_confirmation, old_password: state.old_password, email: userData.user.email }\r\n        fetch(`${Config.BACKEND_URL}/patient/new-password`, {\r\n          method: 'PUT',\r\n          body: JSON.stringify(data),\r\n          headers: {\r\n            'Accept': 'application/json', \r\n            'Content-Type': 'application/json',\r\n            'Authorization': `token ${userData.token}`,\r\n          },\r\n      } )\r\n        .then((res) =>{\r\n          console.log(res);\r\n          setAddedByAdmin(false);\r\n          setUserData(res.data.updatePatient)\r\n        })\r\n        .catch((err) => {\r\n          console.log(err.response)\r\n\r\n        })\r\n      }\r\n      \r\n    }\r\n\r\n    const handleChange = ({target : {value, name}}) => {\r\n      setState(old => {return { ...old, [name]: value}}) ;\r\n  }\r\n\r\n  return (\r\n    <AppContext.Provider value={{ userData, setUser }}>\r\n      {children}\r\n      <Dialog\r\n        // open={false}\r\n        open={addedByAdmin}\r\n        onClose={ () => {}}\r\n        aria-labelledby=\"alert-dialog-title\"\r\n        aria-describedby=\"alert-dialog-description\"\r\n      >\r\n        <DialogTitle id=\"alert-dialog-title\"> Renouveler le mot de passe </DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText id=\"alert-dialog-description\">\r\n            Ce compte à tait créer avec un administrateur, alors ce mot de passe à était générer d'une maniére aléatoir. On vous recomande de saisir un nouveau mot de passe pour la scuité de vos information.\r\n          </DialogContentText>\r\n          <FormControl className=\"mt-3\" fullWidth variant=\"outlined\">\r\n          <InputLabel htmlFor=\"standard-adornment-password\"> {content.new.oldpassLabel} </InputLabel>\r\n          <OutlinedInput\r\n              id=\"standard-adornment-password\"\r\n              type={state.showPassword ? 'text' : 'password'}\r\n              value={state.old_password}\r\n              onChange={handleChange}\r\n              required={true}\r\n              label={content.new.oldpassLabel}\r\n              name=\"old_password\"\r\n              endAdornment={\r\n              <InputAdornment position=\"end\">\r\n                  <IconButton\r\n                      aria-label=\"toggle password visibility\"\r\n                      onClick={ () => setState(old =>{return  {...old, showPassword: !state.showPassword}})} \r\n                  >\r\n                  {state.showPassword ? <MdVisibility /> : <MdVisibilityOff />}\r\n                  </IconButton>\r\n              </InputAdornment>\r\n              }\r\n          />\r\n          </FormControl>\r\n          <FormControl className=\"mt-3\" fullWidth variant=\"outlined\">\r\n          <InputLabel htmlFor=\"standard-adornment-password\"> {content.new.passLabel} </InputLabel>\r\n          <OutlinedInput\r\n              id=\"standard-adornment-password\"\r\n              type={state.showPassword ? 'text' : 'password'}\r\n              value={state.password}\r\n              onChange={handleChange}\r\n              required={true}\r\n              label={content.new.passLabel}\r\n              name=\"password\"\r\n              endAdornment={\r\n              <InputAdornment position=\"end\">\r\n                  <IconButton\r\n                      aria-label=\"toggle password visibility\"\r\n                      onClick={ () => setState(old =>{return  {...old, showPassword: !state.showPassword}})} \r\n                  >\r\n                  {state.showPassword ? <MdVisibility /> : <MdVisibilityOff />}\r\n                  </IconButton>\r\n              </InputAdornment>\r\n              }\r\n          />\r\n          </FormControl>\r\n          <FormControl className=\"mt-3\" fullWidth variant=\"outlined\">\r\n          <InputLabel htmlFor=\"standard-adornment-password\"> {content.new.confirmpassLabel} </InputLabel>\r\n          <OutlinedInput\r\n              id=\"standard-adornment-password\"\r\n              type={state.showPassword ? 'text' : 'password'}\r\n              value={state.password_confirmation}\r\n              onChange={handleChange}\r\n              required={true}\r\n              label={content.new.confirmpassLabel}\r\n              name=\"password_confirmation\"\r\n              endAdornment={\r\n              <InputAdornment position=\"end\">\r\n                  <IconButton\r\n                      aria-label=\"toggle password visibility\"\r\n                      onClick={ () => setState(old =>{return  {...old, showPassword: !state.showPassword}})} \r\n                  >\r\n                  {state.showPassword ? <MdVisibility /> : <MdVisibilityOff />}\r\n                  </IconButton>\r\n              </InputAdornment>\r\n              }\r\n          />\r\n          </FormControl>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleConfirmation} color=\"danger\">\r\n            Confirmer\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n                   \r\n\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  return useContext(AppContext);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}