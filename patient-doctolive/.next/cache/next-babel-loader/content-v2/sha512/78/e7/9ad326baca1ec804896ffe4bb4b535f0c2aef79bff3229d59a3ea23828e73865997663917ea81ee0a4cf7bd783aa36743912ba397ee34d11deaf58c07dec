{"ast":null,"code":"import _toConsumableArray from \"C:/app/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/app/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/app/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _defineProperty from \"C:/app/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport { Col, Row } from 'react-bootstrap';\nimport Link from 'next/link';\nimport Config from './../../../EndPoint';\nimport moment from 'moment';\nimport Button from './../../../components/CustomButtons/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport { BsX, BsFillCameraVideoFill } from 'react-icons/bs';\nimport { MdUpdate } from 'react-icons/md';\nimport { useAuth } from './../../../context/AuthContext';\nimport { useRouter } from 'next/router';\nimport MapAccess from './../../../components/MedecinWidget/MapAccess';\nimport CalendarAvailability from './../../../components/MedecinWidget/CalendarAvailability';\nimport contentFR from './../../../contentFR';\nimport contentEN from './../../../contentEN';\nimport contentAR from './../../../contentAR';\nvar Transition = /*#__PURE__*/React.forwardRef(function Transition(props, ref) {\n  return /*#__PURE__*/_jsx(Slide, _objectSpread({\n    direction: \"up\",\n    ref: ref\n  }, props));\n});\n\nfunction CardAppointment(_ref) {\n  var consultation = _ref.consultation,\n      app_id = _ref.app_id,\n      content = _ref.content;\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: app_id == consultation.id ? \"card selected\" : \"card\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"card-header\",\n        children: [/*#__PURE__*/_jsxs(\"h2\", {\n          children: [\" \", moment(consultation.date + consultation.time, 'YYYY/MM/DDHH:mm').calendar()]\n        }), consultation.teleconsultation ? /*#__PURE__*/_jsx(BsFillCameraVideoFill, {}) : null]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"card-body d-flex\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"doctor-img\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: /*#__PURE__*/_jsx(\"img\", {\n              src: consultation.medecin.image ? \"\".concat(Config.BACKEND_URL, \"/\").concat(consultation.medecin.image) : \"/image/medecin/homme.jpg\",\n              className: \"img-fluid\",\n              alt: \"User Image\"\n            })\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"doc-info-cont\",\n          children: [/*#__PURE__*/_jsxs(\"h4\", {\n            children: [\"  \", consultation.title, \" \"]\n          }), /*#__PURE__*/_jsx(\"h5\", {\n            className: \"doc-name\",\n            children: /*#__PURE__*/_jsxs(\"a\", {\n              href: \"/doctor/\".concat(consultation.medecin.id),\n              children: [\"Dr. \", \"\".concat(consultation.medecin.nom, \" \").concat(consultation.medecin.prenom)]\n            })\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"card-action justify-content-center\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/account/appointments?app_id=\".concat(consultation.id),\n          children: /*#__PURE__*/_jsxs(\"a\", {\n            className: \"link btn btn-primary\",\n            children: [\" \", content.appointments.cardApps.link, \" \"]\n          })\n        })\n      })]\n    })\n  });\n}\n\nexport default function Appointments() {\n  var _useState = useState([]),\n      consultations = _useState[0],\n      setConsultations = _useState[1];\n\n  var _useState2 = useState(),\n      consultation = _useState2[0],\n      setConsultation = _useState2[1];\n\n  var router = useRouter();\n  var locale = router.locale;\n  var content = locale === \"ar\" ? contentAR : locale === \"en\" ? contentEN : contentFR;\n  var app_id = router.query.app_id;\n\n  var _useAuth = useAuth(),\n      userData = _useAuth.userData;\n\n  console.log(userData);\n  useEffect(function () {\n    if (app_id) {\n      fetch(\"\".concat(Config.BACKEND_URL, \"/consultation/\").concat(app_id), {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': \"token \".concat(userData.token)\n        }\n      }).then(function (r) {\n        return r.json().then(function (res) {\n          if (!res.error) {\n            setConsultation(res.consultation);\n          }\n        })[\"catch\"](function (error) {});\n      })[\"catch\"](function (error) {});\n    } else {\n      setConsultation();\n    }\n\n    return function () {};\n  }, [app_id]);\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var res, data;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (userData.token) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\", router.push('account/new'));\n\n          case 2:\n            _context.next = 4;\n            return fetch(\"\".concat(Config.BACKEND_URL, \"/patient/appointments/venir\"), {\n              headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json',\n                'Authorization': \"token \".concat(userData.token)\n              }\n            });\n\n          case 4:\n            res = _context.sent;\n            _context.next = 7;\n            return res.json();\n\n          case 7:\n            data = _context.sent;\n            setConsultations(data.consultations);\n            return _context.abrupt(\"return\", function () {});\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), []);\n\n  var handleCanceledApp = function handleCanceledApp(id) {\n    var index = consultations.findIndex(function (cns) {\n      return cns.id === id;\n    });\n\n    if (index > -1) {\n      setConsultations(function (old) {\n        var cloneOld = _toConsumableArray(old);\n\n        cloneOld.splice(index, 1);\n        return cloneOld;\n      });\n    }\n  };\n\n  var handleUpdatedApp = function handleUpdatedApp(id, consultation) {\n    var index = consultations.findIndex(function (cns) {\n      return cns.id === id;\n    });\n\n    if (index > -1) {\n      setConsultations(function (old) {\n        var cloneOld = _toConsumableArray(old);\n\n        cloneOld[index] = consultation;\n        return cloneOld;\n      });\n    }\n  };\n\n  if (!consultations) return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"container section-content\",\n    children: [/*#__PURE__*/_jsx(\"h1\", {\n      className: \"text-center\",\n      children: \"  \"\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"text-center\"\n    })]\n  });\n\n  if (consultations.length === 0) {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      className: \"container section-content\",\n      children: [/*#__PURE__*/_jsxs(\"h1\", {\n        className: \"text-center\",\n        children: [\" \", content.appointments.myapp, \" \"]\n      }), /*#__PURE__*/_jsxs(\"p\", {\n        className: \"text-center\",\n        children: [\" \", content.appointments.noApp, \" \"]\n      }), /*#__PURE__*/_jsx(Row, {\n        className: \"m-0 justify-content-center\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/account/appointments/historique\",\n          children: /*#__PURE__*/_jsxs(\"a\", {\n            className: \"link black\",\n            children: [\" \", content.appointments.history, \"  \"]\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"text-center\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/\",\n          children: /*#__PURE__*/_jsxs(\"a\", {\n            className: \"link btn btn-primary\",\n            children: [\" \", content.appointments.takeapp, \"  \"]\n          })\n        })\n      })]\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"section-content-app\",\n    children: [/*#__PURE__*/_jsx(Row, {\n      className: \"m-5 justify-content-center\",\n      children: /*#__PURE__*/_jsxs(\"h3\", {\n        children: [\" \", content.appointments.myapp, \" \"]\n      })\n    }), /*#__PURE__*/_jsx(Row, {\n      className: \"m-0 justify-content-center\",\n      children: /*#__PURE__*/_jsx(Link, {\n        href: \"/account/appointments/historique\",\n        children: /*#__PURE__*/_jsxs(\"a\", {\n          className: \"link black\",\n          children: [\" \", content.appointments.history, \" \"]\n        })\n      })\n    }), /*#__PURE__*/_jsxs(Row, {\n      className: \"m-0\",\n      children: [/*#__PURE__*/_jsx(Col, {\n        lg: \"3\",\n        className: \"apointements-left\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"patient-appointments\",\n          children: consultations.map(function (consultation, index) {\n            return /*#__PURE__*/_jsx(Row, {\n              className: \"justify-content-center patient-appointment m-0\",\n              children: /*#__PURE__*/_jsx(CardAppointment, {\n                content: content,\n                consultation: consultation,\n                handleUpdatedApp: handleUpdatedApp,\n                handleCanceledApp: handleCanceledApp,\n                app_id: app_id\n              })\n            }, index);\n          })\n        })\n      }), /*#__PURE__*/_jsx(Col, {\n        lg: \"9\",\n        children: !consultation ? null : /*#__PURE__*/_jsx(Row, {\n          className: \"justify-content-center patient-appointment m-0\",\n          children: /*#__PURE__*/_jsx(CardDetailsAppointment, {\n            content: content,\n            consultation: consultation,\n            handleUpdatedApp: handleUpdatedApp,\n            handleCanceledApp: handleCanceledApp\n          })\n        })\n      })]\n    })]\n  });\n}\n\nfunction CardDetailsAppointment(_ref3) {\n  var _consultation$medecin, _consultation$medecin2, _consultation$medecin3, _consultation$medecin4;\n\n  var consultation = _ref3.consultation,\n      handleCanceledApp = _ref3.handleCanceledApp,\n      content = _ref3.content,\n      handleUpdatedApp = _ref3.handleUpdatedApp;\n\n  var _useAuth2 = useAuth(),\n      userData = _useAuth2.userData;\n\n  var _useState3 = useState(false),\n      ShowonfirmCancel = _useState3[0],\n      setConfirmCancel = _useState3[1];\n\n  var _useState4 = useState(false),\n      ShowonfirmUpdate = _useState4[0],\n      setConfirmUpdate = _useState4[1];\n\n  var _useState5 = useState(),\n      selectedHour = _useState5[0],\n      setSelectedHour = _useState5[1];\n\n  var _useState6 = useState(),\n      selectedDate = _useState6[0],\n      setSelectedDate = _useState6[1];\n\n  var setDetails = function setDetails(day, hour) {\n    setSelectedDate(day);\n    setSelectedHour(hour);\n  };\n\n  var cancelAppointement = function cancelAppointement() {\n    fetch(\"\".concat(Config.BACKEND_URL, \"/consultation/cancel/\").concat(consultation.id), {\n      method: \"PATCH\",\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \"token \".concat(userData.token)\n      },\n      body: JSON.stringify({})\n    }).then(function (r) {\n      return r.json().then(function (res) {\n        if (!res.error) {\n          setConfirmCancel(false);\n          handleCanceledApp(consultation.id);\n        } else {\n          if (res.validator) {} else {}\n        }\n      });\n    })[\"catch\"](function (error) {\n      console.log(error);\n    });\n  };\n\n  var validateTime = function validateTime() {\n    fetch(\"\".concat(Config.BACKEND_URL, \"/consultation/deplacer/\").concat(consultation.id), {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \"token \".concat(userData.token)\n      },\n      body: JSON.stringify({\n        date: selectedDate,\n        time: selectedHour\n      })\n    }).then(function (r) {\n      return r.json().then(function (res) {\n        if (!res.error) {\n          setConfirmUpdate(false);\n          handleUpdatedApp(consultation.id, res.consultation);\n        } else {\n          if (res.validator) {} else {}\n        }\n      });\n    })[\"catch\"](function (error) {\n      console.log(error); // setResponse({sending: false, success:false, donneIncorecte:true})\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"card\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"card-header\",\n        children: [/*#__PURE__*/_jsxs(\"h2\", {\n          children: [\" \", moment(consultation.date + consultation.time, 'YYYY/MM/DDHH:mm').calendar()]\n        }), consultation.teleconsultation ? /*#__PURE__*/_jsx(BsFillCameraVideoFill, {}) : null]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"card-body\",\n        children: [/*#__PURE__*/_jsxs(Row, {\n          children: [/*#__PURE__*/_jsx(Col, {\n            lg: \"7\",\n            md: \"12\",\n            xs: \"12\",\n            children: /*#__PURE__*/_jsxs(Row, {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"doctor-img\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: /*#__PURE__*/_jsx(\"img\", {\n                    src: consultation.medecin.image ? \"\".concat(Config.BACKEND_URL, \"/\").concat(consultation.medecin.image) : \"/image/medecin/homme.jpg\",\n                    className: \"img-fluid\",\n                    alt: \"User Image\"\n                  })\n                })\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"doc-info-cont\",\n                children: [/*#__PURE__*/_jsxs(\"h4\", {\n                  children: [\"  \", consultation.title, \" \"]\n                }), /*#__PURE__*/_jsx(\"h5\", {\n                  className: \"doc-name\",\n                  children: /*#__PURE__*/_jsxs(\"a\", {\n                    href: \"/doctor/\".concat(consultation.medecin.id),\n                    children: [\"Dr. \", \"\".concat(consultation.medecin.nom, \" \").concat(consultation.medecin.prenom)]\n                  })\n                })]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"doc-info-cont ml-5\",\n                children: /*#__PURE__*/_jsxs(\"ul\", {\n                  className: \"contacts\",\n                  children: [/*#__PURE__*/_jsxs(\"li\", {\n                    children: [/*#__PURE__*/_jsxs(\"h6\", {\n                      children: [\" \", content.appointments.cardApp.accessInfos, \"   \"]\n                    }), !consultation.medecin.adress ? \"Vous n'avez pas encore spécifier vos information d'accés\" : (consultation.medecin.adress.streetName ? consultation.medecin.adress.streetName : \"\") + \" \" + (consultation.medecin.adress.buildingName ? consultation.medecin.adress.buildingName : \"\") + \" \" + (consultation.medecin.adress.floor ? \"étage \" + consultation.medecin.adress.floor : \"\") + \" \" + (consultation.medecin.adress.sector ? consultation.medecin.adress.sector : \"\") + \", \" + (consultation.medecin.adress.codePostal ? consultation.medecin.adress.codePostal : \"\") + \" - \" + (consultation.medecin.city ? consultation.medecin.city.name : \"\")]\n                  }), /*#__PURE__*/_jsxs(\"li\", {\n                    children: [/*#__PURE__*/_jsxs(\"h6\", {\n                      children: [\" \", content.appointments.cardApp.secretariat, \" \"]\n                    }), consultation.medecin.phone, \" \"]\n                  })]\n                })\n              })]\n            })\n          }), /*#__PURE__*/_jsx(Col, {\n            lg: \"5\",\n            md: \"12\",\n            xs: \"12\",\n            className: \"order-sm-last\",\n            children: /*#__PURE__*/_jsx(MapAccess, {\n              apiKey: Config.apiKey,\n              locations: [{\n                latitude: consultation === null || consultation === void 0 ? void 0 : (_consultation$medecin = consultation.medecin) === null || _consultation$medecin === void 0 ? void 0 : (_consultation$medecin2 = _consultation$medecin.adress) === null || _consultation$medecin2 === void 0 ? void 0 : _consultation$medecin2.latitude,\n                longitude: consultation === null || consultation === void 0 ? void 0 : (_consultation$medecin3 = consultation.medecin) === null || _consultation$medecin3 === void 0 ? void 0 : (_consultation$medecin4 = _consultation$medecin3.adress) === null || _consultation$medecin4 === void 0 ? void 0 : _consultation$medecin4.longitude\n              }]\n            })\n          })]\n        }), !consultation.teleconsultation ? null : /*#__PURE__*/_jsxs(Row, {\n          className: \"mt-5\",\n          children: [/*#__PURE__*/_jsx(Col, {\n            md: \"6\",\n            children: /*#__PURE__*/_jsxs(\"p\", {\n              children: [\"  \", content.appointments.cardApp.click, \" \"]\n            })\n          }), /*#__PURE__*/_jsx(Col, {\n            md: \"6\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/consultation/\".concat(consultation.id),\n              children: /*#__PURE__*/_jsxs(\"a\", {\n                className: \"link btn btn-primary\",\n                children: [\" \", content.appointments.cardApp.rejoindre, \" \"]\n              })\n            })\n          })]\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"card-action\",\n        children: [/*#__PURE__*/_jsxs(Button, {\n          onClick: function onClick() {\n            return setConfirmUpdate(true);\n          },\n          color: \"transparent\",\n          children: [\" \", /*#__PURE__*/_jsx(MdUpdate, {}), \" \", content.appointments.cardApp.deplacer, \" \"]\n        }), /*#__PURE__*/_jsxs(Button, {\n          color: \"transparent\",\n          onClick: function onClick() {\n            return setConfirmCancel(true);\n          },\n          style: {\n            color: \"#f1000f\"\n          },\n          children: [\" \", /*#__PURE__*/_jsx(BsX, {\n            size: \"32px\"\n          }), \" \", content.appointments.cardApp.annuler, \" \"]\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(Dialog, {\n      open: ShowonfirmCancel,\n      maxWidth: \"lg\" // fullWidth={true}\n      ,\n      TransitionComponent: Transition,\n      keepMounted: false,\n      onClose: function onClose() {\n        return setConfirmCancel(false);\n      },\n      \"aria-labelledby\": \"alert-dialog-slide-title\",\n      \"aria-describedby\": \"alert-dialog-slide-description\",\n      children: [/*#__PURE__*/_jsxs(DialogTitle, {\n        id: \"alert-dialog-slide-title\",\n        children: [\" \", content.appointments.cardApp.confirmCancel, \"  \"]\n      }), /*#__PURE__*/_jsxs(DialogContent, {\n        children: [content.appointments.cardApp.wantYou, \"  \", moment(consultation.date + consultation.time, 'YYYY/MM/DDHH:mm').calendar(), \" \", content.appointments.cardApp[\"with\"], \" Dr. \", \"\".concat(consultation.medecin.nom, \" \").concat(consultation.medecin.prenom)]\n      }), /*#__PURE__*/_jsxs(DialogActions, {\n        children: [/*#__PURE__*/_jsx(Button, {\n          onClick: function onClick() {\n            return setConfirmCancel(false);\n          },\n          color: \"transparent\",\n          children: content.appointments.cardApp.retour\n        }), /*#__PURE__*/_jsx(Button, {\n          onClick: cancelAppointement,\n          color: \"danger\",\n          children: content.appointments.cardApp.annuler\n        })]\n      })]\n    }), !ShowonfirmUpdate ? null : /*#__PURE__*/_jsxs(Dialog, {\n      open: ShowonfirmUpdate,\n      maxWidth: \"lg\",\n      TransitionComponent: Transition,\n      keepMounted: true,\n      \"aria-labelledby\": \"alert-dialog-slide-title\",\n      \"aria-describedby\": \"alert-dialog-slide-description\",\n      children: [/*#__PURE__*/_jsxs(DialogTitle, {\n        id: \"alert-dialog-slide-title\",\n        children: [\" \", content.appointments.cardApp.docAvai, \" \"]\n      }), /*#__PURE__*/_jsx(DialogContent, {\n        children: /*#__PURE__*/_jsx(CalendarAvailability, {\n          showDisponibilite: consultation.medecin,\n          setSelectedHour: setDetails\n        })\n      }), /*#__PURE__*/_jsxs(DialogActions, {\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          children: !selectedHour && !selectedDate ? null : content.appointments.cardApp.selecTtime + \" : \" + moment(selectedDate + selectedHour, 'YYYY/MM/DDHH:mm').calendar()\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(Button, {\n            onClick: function onClick() {\n              setConfirmUpdate(false);\n            },\n            color: \"transparent\",\n            children: content.appointments.cardApp.retour\n          }), /*#__PURE__*/_jsx(Button, {\n            disabled: !selectedHour,\n            onClick: validateTime,\n            color: \"primary\",\n            children: content.appointments.cardApp.confirm\n          })]\n        })]\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}