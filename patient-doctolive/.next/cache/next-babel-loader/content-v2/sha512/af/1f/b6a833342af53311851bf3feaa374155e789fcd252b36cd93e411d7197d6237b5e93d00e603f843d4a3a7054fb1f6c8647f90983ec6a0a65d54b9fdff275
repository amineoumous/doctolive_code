{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useMemo, useEffect, useCallback } from 'react';\nimport { Row, Col, Collapse, Alert } from 'react-bootstrap';\nimport SubmitButton from './../../components/CustomButtons/SubmitButton.js'; // import AddIcon from '@material-ui/icons/Add';\n\nimport { useDropzone } from 'react-dropzone';\nimport { useAuth } from \"../../context/AuthContext\";\nimport Config from './../../EndPoint';\nimport { Typography } from '@material-ui/core';\nimport ReactFancyBox from './../fancyBox/fancybox/ReactFancyBox';\nimport { TiDeleteOutline } from 'react-icons/ti';\nvar baseStyle = {\n  flex: 1,\n  display: 'flex',\n  flexDirection: 'column',\n  alignItems: 'center',\n  padding: '40px 20px',\n  cursor: 'pointer',\n  borderWidth: 2,\n  borderRadius: 2,\n  borderColor: '#eeeeee',\n  borderStyle: 'dashed',\n  backgroundColor: '#fafafa',\n  color: '#bdbdbd',\n  outline: 'none',\n  transition: 'border .24s ease-in-out'\n};\nvar activeStyle = {\n  borderColor: '#2196f3'\n};\nvar acceptStyle = {\n  borderColor: '#00e676'\n};\nvar rejectStyle = {\n  borderColor: '#ff1744'\n};\nexport default function Images(props) {\n  var _useAuth = useAuth(),\n      userData = _useAuth.userData;\n\n  var _useState = useState({\n    success: false,\n    sending: false,\n    donneIncorrect: false\n  }),\n      etatRequest = _useState[0],\n      setEtatRequest = _useState[1];\n\n  var _useState2 = useState([]),\n      files = _useState2[0],\n      setFiles = _useState2[1];\n\n  var _useState3 = useState([]),\n      rejectedFiles = _useState3[0],\n      setRejectedFiles = _useState3[1];\n\n  var _useState4 = useState([]),\n      savedPictures = _useState4[0],\n      setSavedPictures = _useState4[1];\n\n  var _useState5 = useState([]),\n      canceledPictures = _useState5[0],\n      setCanceledPictures = _useState5[1];\n\n  useEffect(function () {\n    if (props.documents) {\n      setSavedPictures(props.documents);\n    }\n\n    return function () {};\n  }, [props.documents]);\n  useEffect(function () {\n    if (props.socket) {\n      props.socket.on('newDocuments', function (response) {\n        if (response.consultationId === props.consultation.id) {\n          setSavedPictures(function (oldPic) {\n            return [].concat(_toConsumableArray(oldPic), _toConsumableArray(response.uploadedFiles));\n          });\n        }\n      });\n    }\n\n    return function () {\n      if (props.socket) {\n        props.socket.removeAllListeners('newDocuments');\n      }\n    };\n  }, [props.socket]);\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              setEtatRequest(function (oldData) {\n                return _objectSpread(_objectSpread({}, oldData), {}, {\n                  sending: true\n                });\n              });\n              _context.prev = 2;\n              _context.next = 5;\n              return fetch(\"\".concat(Config.BACKEND_URL, \"/upload/document\"), {\n                method: 'POST',\n                body: JSON.stringify({\n                  data: files,\n                  consultation: props.consultation,\n                  sentTo: \"medecin\"\n                }),\n                headers: {\n                  'Accept': 'application/json',\n                  'Content-Type': 'application/json',\n                  'Authorization': \"token \".concat(userData.token)\n                }\n              });\n\n            case 5:\n              response = _context.sent;\n              response.json().then(function (uploadingFile) {\n                if (!uploadingFile.error) {\n                  setEtatRequest(function (oldData) {\n                    return _objectSpread(_objectSpread({}, oldData), {}, {\n                      sending: false,\n                      success: true\n                    });\n                  });\n\n                  if (uploadingFile.savedPictures.length > 0) {\n                    setSavedPictures(function (oldPic) {\n                      return [].concat(_toConsumableArray(oldPic), _toConsumableArray(uploadingFile.savedPictures));\n                    });\n                  }\n\n                  if (uploadingFile.canceledData.length > 0) {\n                    uploadingFile.canceledData.map(function (dd) {\n                      setCanceledPictures(function (oldData) {\n                        return [].concat(_toConsumableArray(oldData), [files[dd.index]]);\n                      });\n                    });\n                    setFiles([]);\n                    setRejectedFiles([]);\n                  } else {\n                    setFiles([]);\n                    setRejectedFiles([]);\n                  }\n\n                  props.socket.emit('newDocuments', {\n                    uploadedFiles: uploadingFile.savedPictures,\n                    consultationId: props.consultation.id,\n                    selectedUser: \"m\" + props.consultation.medecin.id\n                  }, function (response) {});\n                } else {\n                  setEtatRequest(function (oldData) {\n                    return _objectSpread(_objectSpread({}, oldData), {}, {\n                      sending: false,\n                      success: false,\n                      donneIncorrect: true\n                    });\n                  });\n                }\n              })[\"catch\"](function (err) {\n                setEtatRequest(function (oldData) {\n                  return _objectSpread(_objectSpread({}, oldData), {}, {\n                    sending: false,\n                    success: false,\n                    donneIncorrect: true\n                  });\n                });\n              });\n              _context.next = 13;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](2);\n              console.log(_context.t0);\n              setEtatRequest(function (oldData) {\n                return _objectSpread(_objectSpread({}, oldData), {}, {\n                  sending: false,\n                  success: false,\n                  donneIncorrect: true\n                });\n              });\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 9]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var deleteImageHandle = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(file) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch(\"\".concat(Config.BACKEND_URL, \"/upload/document\"), {\n                method: 'DELETE',\n                body: JSON.stringify({\n                  path: file.path,\n                  id: file.id\n                }),\n                headers: {\n                  'Accept': 'application/json',\n                  'Content-Type': 'application/json',\n                  'Authorization': \"token \".concat(userData.token)\n                }\n              });\n\n            case 2:\n              response = _context2.sent;\n              response.json().then(function (response) {\n                var index = savedPictures.findIndex(function (fl) {\n                  return fl.id === file.id;\n                });\n                setSavedPictures(function (oldFiles) {\n                  var clone = _toConsumableArray(oldFiles);\n\n                  clone.splice(index, 1);\n                  return clone;\n                });\n              })[\"catch\"](function (error) {});\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function deleteImageHandle(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var removeImageHandle = function removeImageHandle(file) {\n    var index = files.findIndex(function (fl) {\n      return fl.id === file.id;\n    });\n    setFiles(function (oldFiles) {\n      var clone = _toConsumableArray(oldFiles);\n\n      clone.splice(index, 1);\n      return clone;\n    });\n  };\n\n  var onDrop = useCallback(function (acceptedFiles, rejectedFiles) {\n    rejectedFiles.map(function (rejectedFile) {\n      if (rejectedFile.file.type.split('/')[0] === \"image\") {\n        var reader = new FileReader();\n        reader.readAsDataURL(rejectedFile.file);\n\n        reader.onloadend = function () {\n          var newFile = {\n            filePath: reader.result,\n            realName: rejectedFile.file.name,\n            type: 'file',\n            fileType: rejectedFile.file.type.split('/')[0]\n          };\n          setRejectedFiles(function (existing) {\n            return [].concat(_toConsumableArray(existing), [{\n              file: newFile,\n              errors: rejectedFile.errors\n            }]);\n          });\n        };\n      } else {\n        var newFile = {\n          realName: rejectedFile.file.name,\n          type: 'file',\n          fileType: rejectedFile.file.type.split('/')[0]\n        };\n        setRejectedFiles(function (existing) {\n          return [].concat(_toConsumableArray(existing), [{\n            file: newFile,\n            errors: rejectedFile.errors\n          }]);\n        });\n      }\n    });\n    acceptedFiles.forEach(function (file) {\n      var reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onloadend = function () {\n        var newFile = {\n          filePath: reader.result,\n          realName: file.name,\n          type: 'file',\n          fileType: \"image\",\n          kind: file.type\n        };\n        setFiles(function (existing) {\n          return [].concat(_toConsumableArray(existing), [newFile]);\n        });\n      };\n    });\n  }, []);\n\n  var _useDropzone = useDropzone({\n    onDrop: onDrop,\n    accept: 'image/jpeg, image/png, image/jpg, application/pdf'\n  }),\n      getRootProps = _useDropzone.getRootProps,\n      getInputProps = _useDropzone.getInputProps,\n      isDragActive = _useDropzone.isDragActive,\n      isDragAccept = _useDropzone.isDragAccept,\n      isDragReject = _useDropzone.isDragReject;\n\n  var style = useMemo(function () {\n    return _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, baseStyle), isDragActive ? activeStyle : {}), isDragAccept ? acceptStyle : {}), isDragReject ? rejectStyle : {});\n  }, [isDragActive, isDragReject, isDragAccept]);\n  return /*#__PURE__*/_jsx(\"form\", {\n    onSubmit: handleSubmit,\n    autoComplete: \"off\",\n    children: /*#__PURE__*/_jsxs(Col, {\n      children: [savedPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"mb-3\",\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h5\",\n          component: \"h5\",\n          children: \" Documents d\\xE9j\\xE0 partager dans cette consultation \"\n        })\n      }) : null, savedPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"images-saved\",\n        children: savedPictures.map(function (file, index) {\n          return /*#__PURE__*/_jsx(Col, {\n            className: \"mt-5\",\n            lg: \"2\",\n            md: \"4\",\n            xs: \"6\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"image-saved\",\n              children: [file.type === \"application/pdf\" ? /*#__PURE__*/_jsxs(\"a\", {\n                href: Config.BACKEND_URL + file.path,\n                download: file.name,\n                target: \"_blank\",\n                rel: \"noopener noreferrer\",\n                children: [\"  \", /*#__PURE__*/_jsx(\"img\", {\n                  src: \"/image/pdf.png\",\n                  alt: \"...\",\n                  className: \"img-fluid\"\n                }), \" \"]\n              }) : /*#__PURE__*/_jsx(ReactFancyBox, {\n                thumbnail: \"\".concat(Config.BACKEND_URL).concat(file.path),\n                showCloseBtn: false,\n                image: \"\".concat(Config.BACKEND_URL).concat(file.path)\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                onClick: function onClick() {\n                  return deleteImageHandle(file);\n                },\n                className: \"delete-button\",\n                children: [\" \", /*#__PURE__*/_jsx(TiDeleteOutline, {}), \" \"]\n              })]\n            })\n          }, index);\n        })\n      }) : null, /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center justify-content-around mt-4 \",\n        children: /*#__PURE__*/_jsxs(\"div\", _objectSpread(_objectSpread({}, getRootProps({\n          style: style,\n          className: \"dropzone\"\n        })), {}, {\n          children: [/*#__PURE__*/_jsx(\"input\", _objectSpread({}, getInputProps())), /*#__PURE__*/_jsx(\"p\", {\n            children: \"Glisser d\\xE9poser des fichiers ici ou\"\n          }), \" \", /*#__PURE__*/_jsx(\"h4\", {\n            children: \" PARCOURIR SUR MON ORDINATEUR \"\n          })]\n        }))\n      }), canceledPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"mt-5\",\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h5\",\n          component: \"h5\",\n          color: \"error\",\n          children: \" Ces documents n'on pas pus s'enregistrer au sein de nos serveur. essayer ult\\xE9ri\\xE9rement o\\xF9 bien essayer d'autre images \"\n        })\n      }) : null, canceledPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"images-canceled\",\n        children: canceledPictures.map(function (file, index) {\n          return /*#__PURE__*/_jsxs(Col, {\n            className: \"mt-5\",\n            lg: \"2\",\n            md: \"4\",\n            xs: \"6\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"image-canceled\",\n              children: /*#__PURE__*/_jsx(ReactFancyBox, {\n                thumbnail: file.filePath,\n                showCloseBtn: false,\n                image: file.filePath\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsx(Typography, {\n                color: \"error\",\n                children: \" Le serveur n'a pas pus suporter ces fichier \"\n              })\n            })]\n          }, index);\n        })\n      }) : null, /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center justify-content-around mt-4 \",\n        children: files.map(function (file, index) {\n          return /*#__PURE__*/_jsxs(Col, {\n            className: \"mt-5\",\n            lg: \"6\",\n            md: \"6\",\n            xs: \"6\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"selecting-img-container\",\n              children: [/*#__PURE__*/_jsx(ReactFancyBox, {\n                thumbnail: file.kind === \"application/pdf\" ? '/image/fileaccepted.png' : file.filePath,\n                showCloseBtn: false,\n                image: file.kind === \"application/pdf\" ? '/image/fileaccepted.png' : file.filePath\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                onClick: function onClick() {\n                  return removeImageHandle(file);\n                },\n                className: \"delete-button\",\n                children: [\" \", /*#__PURE__*/_jsx(TiDeleteOutline, {}), \" \"]\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsxs(\"p\", {\n                className: \"mt-3\",\n                children: [\" \", file.realName, \" \"]\n              })\n            })]\n          }, index);\n        })\n      }), rejectedFiles.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"mt-5\",\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h5\",\n          component: \"h5\",\n          color: \"error\",\n          children: \" Fichier non acc\\xE9pter ils ne seront pas enregistrer sur le serveur \"\n        })\n      }) : null, /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center mt-4 \",\n        children: rejectedFiles.map(function (rejectedFile, index) {\n          return /*#__PURE__*/_jsxs(Col, {\n            className: \"\",\n            lg: \"6\",\n            md: \"12\",\n            xs: \"12\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"rejected-img-container\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/img/file-rejected.png\",\n                alt: \"fichier rejeter\",\n                className: \"img-fluid\"\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \"mt-3\",\n                children: rejectedFile.errors.map(function (err, ind) {\n                  return /*#__PURE__*/_jsx(\"div\", {\n                    children: err.code === \"file-invalid-type\" ? /*#__PURE__*/_jsxs(Typography, {\n                      color: \"error\",\n                      children: [\" Ce fichier \", /*#__PURE__*/_jsxs(\"span\", {\n                        className: \"type-file-span\",\n                        children: [\" \", rejectedFile.file.realName, \" \"]\n                      }), \" est de type \", /*#__PURE__*/_jsxs(\"span\", {\n                        className: \"type-file-span\",\n                        children: [\" \", rejectedFile.file.fileType, \" \"]\n                      }), \" . Seulement les images \", /*#__PURE__*/_jsx(\"span\", {\n                        className: \"type-file-span\",\n                        children: \"png, jpg et jpeg et document pdf  \"\n                      }), \"  sont acc\\xE9pter \"]\n                    }) : \"\"\n                  }, ind);\n                })\n              })\n            })]\n          }, index);\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        children: /*#__PURE__*/_jsx(Collapse, {\n          \"in\": etatRequest.donneIncorecte,\n          children: /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(Alert, {\n              variant: \"danger\",\n              children: \"Un ou plusieur document n'a pas pus enregistrer\"\n            })\n          })\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        children: /*#__PURE__*/_jsx(Collapse, {\n          \"in\": etatRequest.success,\n          children: /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(Alert, {\n              variant: \"success\",\n              children: \"Les document sont enregistrer avec succ\\xE9s\"\n            })\n          })\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        className: \"align-items-center justify-content-around mt-4 \",\n        children: /*#__PURE__*/_jsx(SubmitButton, {\n          disabled: files.length <= 0,\n          sending: etatRequest.sending,\n          successRequest: etatRequest.success,\n          type: \"submit\",\n          color: \"primary\",\n          children: \" Enregistrer \"\n        })\n      })]\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}