{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"C:/Users/CARRE/Documents/GitHub/doctolive_code/patient-doctolive/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useState, useEffect } from 'react';\nimport Config from './../../EndPoint';\nimport { TiDeleteOutline } from 'react-icons/ti';\nimport { Row, Col, Container, Alert } from 'react-bootstrap';\nimport { useAuth } from './../../context/AuthContext';\nimport ReactFancyBox from './../../components/fancyBox/fancybox/ReactFancyBox';\nimport { useRouter } from 'next/router';\nimport contentFR from './../../contentFR';\nimport contentEN from './../../contentEN';\nimport contentAR from './../../contentAR';\nexport default function Documents() {\n  var router = useRouter();\n  var locale = router.locale;\n\n  var _useAuth = useAuth(),\n      userData = _useAuth.userData;\n\n  var content = locale === \"ar\" ? contentAR : locale === \"en\" ? contentEN : contentFR;\n\n  var _useState = useState([]),\n      savedPictures = _useState[0],\n      setSavedPictures = _useState[1];\n\n  var deleteImageHandle = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(file) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(\"\".concat(Config.BACKEND_URL, \"/upload/document\"), {\n                method: 'DELETE',\n                body: JSON.stringify({\n                  path: file.path,\n                  id: file.id\n                }),\n                headers: {\n                  'Accept': 'application/json',\n                  'Content-Type': 'application/json',\n                  'Authorization': \"token \".concat(userData.token)\n                }\n              });\n\n            case 2:\n              response = _context.sent;\n              response.json().then(function (response) {\n                var index = savedPictures.findIndex(function (fl) {\n                  return fl.id === file.id;\n                });\n                setSavedPictures(function (oldFiles) {\n                  var clone = _toConsumableArray(oldFiles);\n\n                  clone.splice(index, 1);\n                  return clone;\n                });\n              })[\"catch\"](function (error) {});\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function deleteImageHandle(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var res, data;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (userData.token) {\n              _context2.next = 2;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", router.push('account/new'));\n\n          case 2:\n            _context2.next = 4;\n            return fetch(\"\".concat(Config.BACKEND_URL, \"/patient/documents\"), {\n              headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json',\n                'Authorization': \"token \".concat(userData.token)\n              }\n            });\n\n          case 4:\n            res = _context2.sent;\n            _context2.next = 7;\n            return res.json();\n\n          case 7:\n            data = _context2.sent;\n            setSavedPictures(data.documents);\n            return _context2.abrupt(\"return\", function () {});\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })), []);\n\n  if (!savedPictures) {\n    return /*#__PURE__*/_jsx(Container, {\n      children: /*#__PURE__*/_jsxs(\"h3\", {\n        children: [\" \", content.documents.aucun, \" \"]\n      })\n    });\n  }\n\n  if (!savedPictures.length) {\n    return /*#__PURE__*/_jsx(Container, {\n      children: /*#__PURE__*/_jsxs(\"h3\", {\n        children: [\" \", content.documents.aucun, \" \"]\n      })\n    });\n  }\n\n  return /*#__PURE__*/_jsx(Container, {\n    children: /*#__PURE__*/_jsx(Row, {\n      className: \"align-items-center justify-content-around mt-4 \",\n      children: savedPictures.length > 0 ? /*#__PURE__*/_jsx(Row, {\n        className: \"images-saved\",\n        children: savedPictures.map(function (file, index) {\n          return /*#__PURE__*/_jsx(Col, {\n            className: \"mt-5 p-5\",\n            lg: \"4\",\n            md: \"4\",\n            xs: \"6\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"image-saved\",\n              children: [file.type === \"application/pdf\" ? /*#__PURE__*/_jsxs(\"a\", {\n                href: Config.BACKEND_URL + file.path,\n                download: file.name,\n                target: \"_blank\",\n                rel: \"noopener noreferrer\",\n                children: [\"  \", /*#__PURE__*/_jsx(\"img\", {\n                  src: \"/image/pdf.png\",\n                  alt: \"...\",\n                  className: \"img-fluid\"\n                }), \" \"]\n              }) : /*#__PURE__*/_jsx(ReactFancyBox, {\n                thumbnail: \"\".concat(Config.BACKEND_URL).concat(file.path),\n                showCloseBtn: false,\n                image: \"\".concat(Config.BACKEND_URL).concat(file.path)\n              }), /*#__PURE__*/_jsxs(\"p\", {\n                children: [\" \", file.sentTo === \"patient\" ? /*#__PURE__*/_jsxs(\"label\", {\n                  children: [content.documents.sharedBy, \" \"]\n                }) : /*#__PURE__*/_jsxs(\"label\", {\n                  children: [\" \", content.documents.sharedBy, \" \"]\n                }), /*#__PURE__*/_jsxs(\"strong\", {\n                  children: [\" Dr. \", file.medecin.nom + \"  \" + file.medecin.prenom, \" \"]\n                }), \" \"]\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                onClick: function onClick() {\n                  return deleteImageHandle(file);\n                },\n                className: \"delete-button\",\n                children: [\" \", /*#__PURE__*/_jsx(TiDeleteOutline, {}), \" \"]\n              })]\n            })\n          }, index);\n        })\n      }) : null\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}